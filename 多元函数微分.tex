\part{多元函数微分}
\section{多元函数的概念}
在坐标平面上，如果$P_0(x_0,y_0)$是一个点，$\delta > 0$，则称到点$P_0$点距离小于$\delta$的
点$P(x,y)$的全体为$P_0$的$\delta$邻域，记作$B(P_0,\delta)$，即
\begin{align*}
    B(P_0,\delta) & = \{P:\abs{PP_0}<\delta\}                          \\
                  & = \{(x,y)\,|\, (x-x_0)^2 + (y-y_0)^2 < \delta^2 \}
\end{align*}

一个平面点集$E$中的点$P$称为\textcolor{red}{\textbf{\textsf{内点}}}，是指存在一个邻域$B(P_0,\delta)$，
满足
\[ B(P_0,\delta) \subset E \]
每个点都是内点的平面点集称为\textcolor{red}{\textbf{\textsf{开集}}}。如果一个平面点集包含了每个边界点，
则称为\textcolor{red}{\textbf{\textsf{闭集}}}。若平面点集中的任意两个点可以用点集中的一条连续取许连接，
则称该点集为\textcolor{red}{\textbf{\textsf{连通点集}}}。
连通的开集称为\textcolor{red}{\textbf{\textsf{开区域}}}，常简称为\textcolor{red}{\textbf{\textsf{区域}}}；
连通的闭集称为\textcolor{red}{\textbf{\textsf{闭区域}}}，有时也简称区域。

从$n$维向量空间$\mathbb{R}^n$的非空子集$X$到实数域$\mathbb{R}$的映射$f:X\to \mathbb{R}$，称为$n$元函数。

\section{多元函数的极限}
按照向量表示法，多元函数的极限可以统一定义为
\begin{definition}
    设函数$f(x)$在$\bm{x}_0\in\mathbb{R}^n$点的某邻域内有定义，称$\bm{x}\to\bm{x}_0$时，
    $f(\bm{x})$的极限为$A$，记作
    \[ \lim_{\bm{x}\to\bm{x}_0}f(\bm{x})=A \]
    如果对充分小的$\varepsilon>0$，都存在$\delta>0$，使当$0<\norm{\bm{x}-\bm{x}_0}<\delta$时，恒有
    \[ \abs{f(\bm{x})-A}<\varepsilon \]
\end{definition}

\subsection{二重极限}
按照分量表示法，二元函数在内点的极限可以定义如下
\begin{definition}
    设函数$f(x,y)$在$(x_0,y_0)$点的某邻域内有定义，称$(x,y)\to(x_0,y_0)$时，$f(x,y)$的极限为$A$，记作
    \[ \lim_{(x,y)\to(x_0,y_0)} f(x,y) = A \]
    如果对任意小的$\varepsilon>0$，都存在$\delta>0$，使当
    \[ 0<(x-x_0)^2 +(y-y_0)^2<\delta \]
    时，恒有
    \[ \abs{f(x,y)-A} < \varepsilon \]
\end{definition}

多元函数的极限具有唯一性、局部有界性、局部保号性、四则运算法则、两边夹法则、变量代换法则和海因定理等。

\begin{theorem}
    如果对任意的$\varepsilon>0$，当$(x,y)\to(x_0,y_0)$时，恒有
    \[ A-\varepsilon \leftarrow f(x,y,\varepsilon) \leq h(x,y)\leq g(x,y,\varepsilon) \to A + \varepsilon \]
    则
    \[ \lim_{(x,y)\to(x_0,y_0)} h(x,y) = A \]
\end{theorem}

变量代换法则可以表述为
\begin{theorem}
    设$\lim_{(x,y)\to(x_0,y_0)} f(x,y) = A, \lim_{t\to A} g(t) = B$，若$(x,y)\to(x_0,y_0)$时，恒有
    $f(x,y)\to,\neq A$，则
    \[ \lim_{(x,y)\to(x_0,y_0)} g[f(x,y)] = \lim_{t\to A}g(t) = B \]
\end{theorem}
更一般地，有
\begin{theorem}
    设$\lim_{(x,y)\to(x_0,y_0)} f(x,y) = A$，若$(u,v)\to(u_0,v_0)$时，恒有
    \[ (x(u,v),y(u,v))\to,\neq(x_0,y_0) \]
    则
    \[ \lim_{(u,v)\to(u_0,v_0)}f(x(u,v),y(u,v)) = \lim_{(x,y)\to(x_0,y_0)} f(x,y) = A \]
\end{theorem}

海因定理可以描述为\textbf{\textsf{二重极限存在=数列话极限恒存在且相等}}，即
\begin{theorem}
    $\lim_{(x,y)\to(x_0,y_0)}f(x,y) = A \iff $当$n\to\infty$时$(x_n,y_n)\to,\neq(x_0,y_0)$，恒有
    \[ \lim_{n\to\infty} f(x_n,y_n) = A \]
\end{theorem}
\begin{situation}
    海因定理常用来否定极限的存在性，更常用的是一元化方法：\textbf{\textsf{二重极限存在=一元化极限存在且相等}}。
\end{situation}
\begin{theorem}
    $\lim_{(x,y)\to(x_0,y_0)}f(x,y) = A \iff $当$x=x(t),y=y(t)$为连续曲线且$(x(t),y(t))=(x_0,y_0)$只有$t=t_0$解时，
    恒有
    \[ \lim_{t\to t_0}f(x(t),y(t)) = A \]
\end{theorem}

对于二元函数，其在$(x_0,y_0)$处的极限存在，根据上述定理可知，对于任意一条参数化曲线$x=x(t),y=y(t)$，其逼近$(x_0,y_0)$时，
所得极限值需要相等。

\begin{example}
    证明函数$f(x,y)=(1+xy)^{\frac{1}{x+y}}$在原点$(0,0)$处的极限不存在。
\end{example}
\begin{proof}
    \[ \lim_{(x,y)\to(0,0)}f(x,y) = \exp\left(\lim_{(x,y)\to(0,0)}\frac{\ln(1+xy)}{x+y}\right) \]
    令$y=\lambda x$，
    则
    \[
        \lim_{(x,y)\to(0,0)}f(x,y)
        = \exp\left(\lim_{x\to 0}\frac{\ln(1+\lambda x^2)}{(1+\lambda)x}\right)
        = \exp\left(\lim_{x\to 0}\frac{\lambda x}{1+\lambda}\right)
    \]
    其中$\lambda \neq -1$时，原极限为$1$。当$\lambda = -1$时，需要考察一条曲线在$(0,0)$处切线为$y=-x$时的逼近，
    不妨令$y=x^2-x$，则有
    \[
        \lim_{(x,y)\to(0,0)}f(x,y)
        = \lim_{x\to 0} f(x,x^2-x)
        = \exp\left(\lim_{x\to 0}\frac{\ln(1+x^3-x^2)}{x^2}\right)
        = \frac{1}{\mathrm{e}}
    \]
    故沿两个曲线逼近$(0,0)$的极限不相等，所以原极限不存在。
\end{proof}

\subsection{二次极限}
形如
\[ \lim_{y\to y_0} \lim_{x\to x_0}f(x,y),\qquad \lim_{x\to x_0}\lim_{y\to y_0}f(x,y) \]
的极限称为二次极限。

二重极限与二次极限没有直接关系，但存在间接关系。
\begin{theorem}
    若$\lim_{(x,y)\to(x_0,y_0)}f(x,y)$存在且当$x\to,\neq x_0$时，$\lim_{y\to y_0}f(x,y)$存在，
    则$\lim_{x\to x_0} \lim_{y\to y_0}f(x,y)$存在且
    \[ \lim_{(x,y)\to(x_0,y_0)}f(x,y) = \lim_{x\to x_0} \lim_{y\to y_0}f(x,y) \]
\end{theorem}

\begin{theorem}
    若
    \[\lim_{(x,y)\to(x_0,y_0)}f(x,y)\]
    \[\lim_{x\to x_0} \lim_{y\to y_0}f(x,y)\]
    \[\lim_{y\to y_0}\lim_{x\to x_0}f(x,y)\]
    存在，则三者相等。
\end{theorem}

\begin{theorem}
    若二次极限
    \[ \lim_{x\to x_0} \lim_{y\to y_0}f(x,y),\lim_{y\to y_0}\lim_{x\to x_0}f(x,y) \]
    都存在，但不相等，则二重极限$\lim_{(x,y)\to(x_0,y_0)}f(x,y)$不存在。
\end{theorem}

\subsection{多元函数的连续性}
如果函数的极限值等于函数值，即
\[ \lim_{(x,y)\to(x_0,y_0)} f(x,y) = f(x_0,y_0) \]
则称$f(x,y)$在$(x_0,y_0)$处连续。如果函数$f(x,y)$在区域或闭区域$E$上的每个点都连续，则称$f(x,y)$是$E$上的连续函数，
记作$f\in C(E)$

连续函数的四则运算一定是连续函数，连续函数的复合函数也一定是连续函数。对于二元初等函数，其在有定义的区域内都是连续函数，
且满足有限次四则运算、有限次复合运算得到的二元函数也称为二元初等函数。

在有界闭区域上的连续函数具有有界性、最值性、介值性和一致连续性。

\section{多元函数的偏导数}
\subsection{一阶偏导数}
\subsubsection{偏导数的概念}
一元函数$x\mapsto f(x,y)$的导数称为二元函数$(x,y)\mapsto f(x,y)$的偏导数，记为$f'_x(x,y)$，用极限语言描述为
\begin{definition}
    设函数$z=f(x,y)$在$(x_0,y_0)$点的某个邻域内有定义，如果
    \[ \lim_{\Delta x\to 0} \frac{f(x_0+\Delta x,y_0)-f(x_0,y_0)}{\Delta x} \]
    存在，则称此极限为函数$z=f(x,y)$在$(x_0,y_0)$点对$x$的偏导数，记作
    \[
        f'_x(x_0,y_0),\,
        f'_1(x_0,y_0),\,
        \pdv{f}{x}(x_0,y_0),\,
        \eval{\pdv{f}{x}}_{(x_0,y_0)},\,
        \eval{\pdv{z}{x}}_{(x_0,y_0)},\,
        z'_{(x_0,y_0)}
    \]
\end{definition}

由此定义可知，二元函数是否可导与是否连续没有直接关系。即\textcolor{red}{“可导$\centernot\implies$连续”}

如果函数$z=f(x,y)$在区域$D$内的每一个点对$x$的偏导数都存在，那么这个偏导数也是$x,y$的导数，称为偏导函数，也简称偏导数。
如果两个偏导数都存在时，则称二原函数可导。

\begin{situation}
    求一个给定点的偏导数，通常时先求偏导函数，再求偏导函数的函数值。对于特殊点的偏导数，大多需要用定义计算，
    或用非求导变量先代入的一元化方法。
\end{situation}

\subsubsection{偏导数的几何意义}
设函数$z=f(x,y)$在区域$D$上连续可导，则它的图像是一个曲面，记为$\Sigma$。那么对于曲面上任意一点$(x_0,y_0,z_0)$，
其延$x,y$轴方向的切向量为
\[ (1,0,f'_x(x,y)),\quad(0,1,f'_y(x,y)) \]
则法向量为
\begin{equation}
    \bm{n} = (1,0,f'_x(x,y)) \times (0,1,f'_y(x,y)) = (-z'_x, -z'_y, 1)
\end{equation}
得到了法向量，就可以构建此点的切平面方程和法线方程。

更一般地，偏导数可以用来表示参数曲面的坐标线切下来和曲面法向量。设参数曲面
\[ \Sigma : \bm{r}=(x(u,v),y(u,v),z(u,v)) \]
可以看成时$u$-曲线
\[ u \mapsto (x(u,v),y(u,v),z(u,v)) \]
和$v$-曲线编织的图形。根据切向量的定义，两条曲线的切向量分别为
\[
    \pdv{\bm{r}}{u} = \left(\pdv{x}{u}, \pdv{y}{u}, \pdv{z}{u}\right)
    ,\quad
    \pdv{\bm{r}}{v} = \left(\pdv{x}{v}, \pdv{y}{v}, \pdv{z}{v}\right)
\]
则法向量为
\begin{equation}
    \bm{n} = \pdv{\bm{r}}{u} \times \pdv{\bm{r}}{v} =
    \begin{vmatrix}
        \bm{i} & \bm{j} & \bm{k} \\
        x'_u   & y'_u   & z'_u   \\
        x'_v   & y'_v   & z'_v
    \end{vmatrix}
    =
    \left(\pdv{(y,z)}{(u,v)},\pdv{(z,x)}{(u,v)}, \pdv{(x,y)}{(u,v)}\right)
\end{equation}
其中
\[
    \pdv{(y,z)}{(u,v)} =
    \begin{vmatrix}
        y'_u & z'_u \\
        y'_v & z'_v
    \end{vmatrix},\quad
    \pdv{(z,x)}{(u,v)} =
    \begin{vmatrix}
        z'_u & x'_u \\
        z'_v & x'_v
    \end{vmatrix},\quad
    \pdv{(x,y)}{(u,v)} =
    \begin{vmatrix}
        x'_u & y'_u \\
        x'_v & y'_v
    \end{vmatrix}
\]
并称为\textcolor{red}{\textbf{\textsf{雅可比行列式}}}。

\subsection{高阶偏导数}
对于函数$z=f(x,y)$，其偏导数$f'_x(x,y), f'_y(x,y)$的偏导数称为$z=f(x,y)$的二阶偏导数，记为
\begin{align*}
    \pdv{x}(\pdv{z}{x}) & = \pdv[2]{z}{x} = \pdv[2]{f}{x} = z''_{xx}=f''_x(x,y)    \\
    \pdv{y}(\pdv{z}{x}) & = \pdv{z}{y}{x} = \pdv{f}{y}{x} = z''_{xy}=f''_{xy}(x,y) \\
    \pdv{x}(\pdv{z}{y}) & = \pdv{z}{x}{y} = \pdv{f}{x}{y} = z''_{yx}=f''_{yx}(x,y) \\
    \pdv{y}(\pdv{z}{y}) & = \pdv[2]{z}{y} = \pdv[2]{f}{y} = z''_{yy}=f''_{yy}(x,y) \\
\end{align*}
其中$\displaystyle\pdv{z}{y}{x}$称为$z$先对$x$后对$y$的二阶混合偏导数。

对于二阶混合偏导数能否交换偏导顺序，有如下定理
\begin{theorem}
    设$f''_{xy}(x,y),f''_{yx}(x,y)$在$(x_0,y_0)$点连续，则
    \[ f''_{xy}(x_0,y_0) = f''_{yx}(x_0,y_0) \]
\end{theorem}

\section{多元函数的全微分}
\subsection{一阶全微分}
\subsubsection{全微分的概念}
对于二元函数$z=f(x,y)$的增量
\[ \Delta z = f(x+\Delta x,y+\Delta y) - f(x,y) \]
用线性逼近的形式应为$\dd{z} = A \Delta x + B \Delta y$，最佳逼近条件为
\[ \Delta z- \dd{z} = \Delta z - A\Delta x - B \Delta y = o(\rho) \quad (\rho \to 0) \]
其中$\rho = \sqrt{\Delta x^2 + \Delta y^2}$。

根据上述描述，可定义
\begin{definition}
    设函数$z=f(x,y)$在$(x,y)$点的某邻域内有定义。如果存在常数$A,B$使当
    \[ \rho = \sqrt{\Delta x^2 + \Delta y^2} \to 0 \]
    时，恒有
    \[ \Delta z - A\Delta x - B\Delta y = o(\rho) \]
    则称$A\Delta x + B\Delta y$为函数$z=f(x,y)$在$(x,y)$点的微分，记作
    \[ \dd{z} = \dd{f}(x,y) = A\Delta x + B\Delta y \]
\end{definition}
微分存在时称函数可微，当函数在区域$D$内每个点都可微时，称函数时区域$D$内的可微函数。

要判断函数的可微性，首先需要微分$A\Delta x+ B\Delta y$的系数；其次需要证明极限关系
\begin{equation}
    \lim_{\substack{\Delta x\to 0\\ \Delta y \to 0}}
    = \frac{\Delta z - (A\Delta x + B\Delta y)}{\sqrt{\Delta x^2 + \Delta y^2}}
    =0
\end{equation}

\subsubsection{微分中值定理}
对于一元可微函数$y=f(x)$，拉格朗日中值定理\ref{th:拉格朗日中值定理}，
\[ f(x+\Delta x) = f(x) + f'(x+\theta x)\Delta x,\quad (0<\theta<1) \]
将这一定理推广至二元函数，则有
\begin{theorem}
    （微分中值定理）
    \label{th:微分中值定理}
    设函数$z=f(x,y)$在矩形域
    \[ D = \{(x,y)\,|\,\abs{x-x_0}<\delta_1, \abs{y-y_0} < \delta_2 \} \]
    上有定义，若$f(x,y)$在$D$内可导，则当$\abs{\Delta x}<\delta_1, \abs{\Delta y}<\delta_2$时，
    必存在$\theta_1,\theta_2\in(0,1)$，使得
    \begin{align*}
        \Delta z & = f(x_0+\Delta x, y_0 +\Delta y) - f(x_0,y_0)                                                 \\
                 & =f'_x(x_0+\theta_1\Delta x, y_0 + \Delta y) \Delta x + f'_y(x_0,y_0+\theta_2\Delta y)\Delta y
    \end{align*}
\end{theorem}
可以理解为函数先沿$x$-曲线变化到$f(x_0,y_0+\Delta y)$，这个变化与$f'_y$相关；
之后再延$y$-曲线变化到$f(x_0+\Delta x, y_0+\Delta y)$，这个变化与$f'_x$相关。

作为推论有
\begin{theorem}
    对于微分中值定理的推论，有
    \begin{enumerate}[(1)]
        \item 设函数$z=f(x,y)$在区域$D$内可导且两个偏导数恒为零，则$f(x,y)$在$D$内必为常数。
        \item 设函数$z=f(x,y)$在$(x_0,y_0)$点的某邻域内可导且两偏导数有界，则$f(x,y)$在$(x_0,y_0)$点连续。
    \end{enumerate}
\end{theorem}

\subsubsection{可微性条件}
用定义直接判断可微性是比较困难的，因此有必要探究可微的条件。
\begin{theorem}
    （可微的必要条件）
    若函数$z=f(x,y)$在$(x,y)$点可微，$\implies$
    \begin{enumerate}[(1)]
        \item $f(x,y)$在$(x,y)$点连续；
        \item $f(x,y)$在$(x,y)$点可导，且$\dd{z} = f'_x(x,y)\Delta x+ f'_y(x,y)\Delta y$；
        \item 当$x,y$为自变量时，有
              \[ \dd{z} = f'_x(x,y)\dd{x}, f'_y(x,y)\dd{y} \]
    \end{enumerate}
\end{theorem}

可微可以推出连续，也可以推出可导，但可导不能推出连续，自然不能推出可微。判断可微一般通过下面的定理来得出。
\begin{theorem}
    （可微的充分条件）
    \label{th:可微的充分条件}
    若函数$z=f(x,y)$在$(x,y)$点的偏导数连续，则$z=f(x,y)$在$(x,y)$点处可微。
\end{theorem}
这里要注意偏导是可微的\textcolor{red}{充分条件但非必要条件}。例如下面的例子中$f(x,y)$在$(0,0)$点
偏导不连续，但却可微。
\begin{example}
    讨论函数
    \[
        f(x,y) =
        \begin{cases}
            (x^2+y^2)\sin \frac{1}{x^2+y^2}, & x^2+y^2 \neq 0, \\
            0,                               & x^2+y^2=0
        \end{cases}
    \]
    在$(0,0)$点是否可微，其偏导数是否连续。
\end{example}
\begin{solution}
    \begin{align*}
          & \lim_{\substack{\Delta x\to 0  \\ \Delta y \to 0}} \frac{f(\Delta x, \Delta y)-(A\Delta x+ B\Delta y)}{\sqrt{\Delta x^2 + \Delta y^2}}\\
        = & \lim_{\substack{\Delta x\to 0  \\ \Delta y \to 0}} \frac{(\Delta x^2+\Delta y^2)\sin \frac{1}{\Delta x^2+\Delta y^2} - (A\Delta x + B \Delta y)}{\sqrt{\Delta x^2 + \Delta y^2}}\\
        = & \lim_{\substack{\Delta x\to 0  \\ \Delta y \to 0}} \sqrt{\Delta x^2 + \Delta y^2}\sin \frac{1}{\Delta x^2 +\Delta y^2} - \lim_{\substack{\Delta x\to 0 \\ \Delta y \to 0}} \frac{A\Delta x + B\Delta y}{\sqrt{\Delta x^2 + \Delta y^2}}\\
        = & -\lim_{\substack{\Delta x\to 0 \\ \Delta y \to 0}} \frac{A\Delta x + B\Delta y}{\sqrt{\Delta x^2 + \Delta y^2}}
    \end{align*}
    其中$A,B$为常数，当$A=B=0$时原极限存在且为零，此时可得$f(x,y)$在$(0,0)$处可微。

    当$ x^2+y^2 \neq 0$时，
    \begin{align*}
        f'_x(x,y) & = 2x\sin\frac{1}{x^2+y^2} -\frac{2x}{x^2+y^2}\cos\frac{1}{x^2+y^2} \\
        f'_y(x,y) & = 2y\sin\frac{1}{x^2+y^2} -\frac{2y}{x^2+y^2}\cos\frac{1}{x^2+y^2}
    \end{align*}
    当$x^2+y^2=0$，即$x=y=0$时，
    \begin{align*}
        f'_x(0,0) & = \lim_{x\to 0} \frac{f(x,0)-f(0,0)}{x-0} = \lim_{x\to 0}x\sin\frac{1}{x^2} = 0 \\
        f'_y(0,0) & = \lim_{y\to 0} \frac{f(0,y)-f(0,0)}{y-0} = \lim_{y\to 0}y\sin\frac{1}{y^2} = 0
    \end{align*}
    由于
    \[ \lim_{x\to 0} f'_x(x,0) = \lim_{x\to 0}\frac{-2}{x}\cos\frac{1}{x^2} = \text{不存在} \]
    \[ \lim_{y\to 0} f'_y(0,y) = \lim_{y\to 0}\frac{-2}{y}\cos\frac{1}{y^2} = \text{不存在} \]
    所以偏导函数$f'_x(x,y),f'_y(x,y)$在$(0,0)$点不连续。
\end{solution}

\begin{theorem}
    若$f'_x(x,y)$在$(x_0,y_0)$处连续，$f'_y(x,y)$在$(x_0,y_0)$点存在，则
    $f(x,y)$在$(x_0,y_0)$点可微。
\end{theorem}

利用一元函数的可微与可导的等价性，可以证明一元可微函数与二元可微函数的复合函数仍是可微函数，即
\begin{theorem}
    设函数$u=f(x,y)$在$(x_0,y_0)$点可微，函数$z=g(u)$在$u_0=f(x_0,y_0)$点可微，
    则函数$z=g(f(x,y))$在$(x_0,y_0)$点可微并且有
    \[ \eval{\dd{z}}_{(x_0,y_0)} = g'(u_0)\dd{f}(x_0,y_0) = g'(u_0)\left[f'_x(x_0,y_0)\dd{x} + f'_y(x_0,y_0)\dd{y}\right] \]
\end{theorem}

\subsubsection{一阶全微分不变性}
对于可微函数的复合形式
\[ z= f(\varphi(x,y),\psi(x,y)) \]
或联立形式
\[ z = f(u,v), u=\varphi(x,y), v=\psi(x,y) \]
可以证明微分公式
\begin{equation}
    \dd{z}
    = \pdv{f}{u}\dd{\varphi} + \pdv{f}{v}\dd{\psi}
    = f'_1\dd{\varphi} + f'_2\dd{\psi}
\end{equation}
这一性质称为\textcolor{red}{\textbf{\textsf{一阶全微分的不变性}}}。
\begin{proof}
    设可微函数$z=F(x,y) = f(\varphi(x,y), \psi(x,y))$，则
    \begin{align*}
        \dd{F} & = \pdv{F}{x}\dd{x} + \pdv{F}{y}\dd{y}                                     \\
               & = \left(\pdv{f}{u}\pdv{\varphi}{x} + \pdv{f}{v}\pdv{\phi}{x}\right)\dd{x}
        +\left(\pdv{f}{u}\pdv{\varphi}{y} + \pdv{f}{v}\pdv{\phi}{y}\right)\dd{y}           \\
               & =\pdv{f}{u}\dd{\varphi} + \pdv{f}{v}\dd{\psi}
    \end{align*}
\end{proof}

对于隐函数的求导委托，可以方程两端同时微分后解出方程即可。
\begin{example}
    设
    \[
        \begin{cases}
            x=-u^2+v+z, \\
            y=u+vz
        \end{cases}
    \]
    求$\displaystyle \pdv{u}{x}, \pdv{v}{x}, \pdv{u}{y}$
\end{example}
\begin{solution}
    方程组两端同时微分可得
    \[
        \begin{cases}
            \dd{x} = -2u\dd{u} + \dd{v} + \dd{z} \\
            \dd{y} = \dd{u} + z\dd{v} + v\dd{z}
        \end{cases}
    \]
    解得
    \[ \dd{u} = \frac{-z\dd{x} + (z-v)\dd{z} + \dd{y}}{2uz + 1} \]
    \[ \dd{v} = \frac{\dd{x} + 2u\dd{y} - (1+2uv)\dd{z}}{2uz + 1} \]
    由此可得
    \[
        \pdv{u}{x} = -\frac{z}{2uv+1},\quad
        \pdv{v}{x} = \frac{1}{2uz+1},\quad
        \pdv{u}{y} = \frac{1}{2uz+1}
    \]
\end{solution}

\subsubsection{微分的几何意义}
微分的几何意义为：
\[ \text{可微~} \iff \text{ 可导~}+\text{ 切平面存在} \]
微分就是切平面函数的增量。

\subsection{高阶全微分}
二元函数$z=f(x,y)$的全微分是一个四元函数
\[ (x,y,\dd{x},\dd{y})\mapsto f'_x(x,y)\dd{x} + f'_y(x,y)\dd{y} \]
如果$x,y$是自变量，则$\dd{x},\dd{y}$也是自变量，此时$\dd{x},\dd{y}$可以视为相对常量。在这种约定下，二元函数
$F(x,y)=f'_x(x,y)\dd{x}+ f'_y(x,y)\dd{y}$的微分$\dd{F}$称为二元函数$z=f(x,y)$的二阶全微分$\dd[2]{(}x,y)$，即
\begin{equation}
    \dd[2]{f}
    = \dd{F}
    = \pdv[2]{f}{x}\dd{x}\dd{x}
    + \pdv{f}{x}{y}\dd{x}\dd{y}
    + \pdv{f}{y}{x}\dd{y}\dd{x}
    + \pdv[2]{f}{y}\dd{y}\dd{y}
\end{equation}
作交换性约定
\[
    \dd{x}\dd{x} = \dd{x^2},\quad \dd{x}\dd{y}= \dd{y}\dd{x},\quad \dd{y}\dd{y}=\dd{y^2}
\]
则有全微分的二项式公式
\begin{equation}
    \dd[2]{f}
    = \pdv[2]{f}{x}\dd{x^2}
    + 2\pdv{f}{x}{y}\dd{x}\dd{y}
    + \pdv[2]{f}{y}\dd{y^2}
    = \left(\pdv{x}\dd{x} + \pdv{y}\dd{y}\right)^2 f
\end{equation}
值得注意的是当$x,y$不是自变量时，全微分二项式公式不成立。而应为
\begin{equation}
    \begin{split}
        \dd[2]{z}
        &= \dd(\pdv{f}{x}\dd{x} + \pdv{f}{y}\dd{y})                    \\
        &= \dd(\pdv{f}{x})\dd{x}
        + \pdv{f}{x}\dd[2]{x}
        + \dd(\pdv{f}{y})\dd{y}
        + \pdv{f}{y}\dd[2]{y}                                                                                 \\
        &= \left(\pdv[2]{f}{x}\dd{x} + \pdv{f}{y}{x}\dd{y}\right)\dd{x}
        + \pdv{f}{x}\dd[2]{x}
        + \left(\pdv{f}{x}{y}\dd{x} + \pdv[2]{f}{y}\dd{y}\right)
        + \pdv{f}{y}\dd[2]{y}                                                                                 \\
        &= \left(\pdv{x}\dd{x} + \pdv{y}\dd{y}\right)^2 f
        + \pdv{f}{x}\dd[2]{x}
        + \pdv{f}{y}\dd[2]{y}
    \end{split}
\end{equation}
其中$\dd[2]{x}$为$x$的二阶全微分，$\dd[2]{y}$为$y$的二阶全微分。


\section{多元函数的微分法}
\subsection{复合函数微分法}
.
\begin{theorem}
    （链法则）
    \label{th:链法则}
    设函数$u=\varphi(x,y),v=\psi(x,y)$在$(x,y)$点可导，函数$z=f(u,v)$在对应点$(u,v)$可微，则复合函数$z=f(u(x,y),v(x,y))$在$(x,y)$点可导
    且
    \[
        \pdv{z}{x} = \pdv{f}{u}\cdot\pdv{\varphi}{x} + \pdv{f}{v}\cdot\pdv{\phi}{x}
    \]
    \[
        \pdv{z}{y} = \pdv{f}{u}\cdot\pdv{\varphi}{y} + \pdv{f}{v}\cdot\pdv{\phi}{y}
    \]
\end{theorem}

\begin{theorem}
    更一般的链法则：设函数$u=f(x_1,x_2,\cdots,x_n)$可微，$x_i=x_i(t_1,t_2,\cdots,t_m)$可导，则复合函数$u=f(x_1(t_1,t_2,\cdots,t_m),\cdots,x_n(t_1,t_2,\cdots,t_m))$可导，且有
    \[
        \pdv{u}{t_j} = \sum_{i=1}^n \pdv{f}{x_i}\cdot\pdv{x_i}{t_j}, \quad j = 1,2,\cdots,m
    \]
\end{theorem}

\subsection{隐函数微分法}
\subsubsection{隐函数定理}
设$F(x,y)=0$时一个二元函数，如果方程
\[ F(x,y) = 0 \]
存在一个解函数$y=f(x)$，则称这个解函数微隐函数。
\begin{theorem}
    （隐函数定理）
    \label{th:隐函数定理}
    设函数$F(x,y),F'_y(x,y)$在$(x_0,y_0)$附近连续且
    \[ F(x_0,y_0) = 0, \quad F'_y(x_0,y_0)\neq 0 \]
    则在$(x_0,y_0)$点的某个邻域内，唯一存在连续函数$y=f(x)$，使得
    \[ F(x,f(x)) \equiv 0 \]
    并当$F'_x(x,y)$在该邻域连续时，$y=f(x)$连续可导且
    \[ f'(x) = - \frac{F'_x(x,y)}{F'_y(x,y)} \]
\end{theorem}

更一般的隐函数定理是
\begin{theorem}
    设$x=(x_1,x_2,\cdots,x_n),y=(y_1,y_2,\cdots,y_m)$，若函数
    \[ F(x,y) = (F_1(x,y),\cdots,F_m(x,y)) \]
    在$(x_0,y_0)$附近连续可导，且
    \[ F(x_0,y_0) = 0, \quad\eval{\pdv{(F_1,\cdots,F_m)}{(y_1,\cdots,y_m)}}_{(x_0,y_0)} \neq 0 \]
    则在$(x_0,y_0)$点的某个邻域内，唯一存在连续可导函数$y=f(x)$，使得
    \[ F(x,f(x))\equiv 0 \]
    且当$1\leq i \leq n, 1\leq j\leq m$时，恒有
    \[
        \pdv{y_j}{x_i}
        =
        \left.
        - \pdv{(F_1\cdots,F_m)}{(y_1,\cdots,y_{j-1},x_i,y_{j+1},\cdots,y_m)}
        \middle/
        \pdv{(F_1\cdots,F_m)}{(y_1,\cdots,y_m)}
        \right.
    \]
\end{theorem}

隐函数求导公式的特征可概括为：\textbf{\textsf{雅可比，变分子；$A$导$B$，$A$换$B$}}。
其中$F_1,F_2,\cdots,F_m$为方程组
\[
    \begin{cases}
        F_1(x,y) = 0, \\
        F_2(x,y) = 0, \\
        \cdots        \\
        F_m(x,y) = 0
    \end{cases}
\]
分母为
\begin{equation}
    \pdv{(F_1\cdots,F_m)}{(y_1,\cdots,y_m)}
    =
    \begin{vmatrix}
        \pdv{ F1}{y_1} & \dots  & \pdv{ F1}{y_m} \\
        \vdots         & \ddots & \vdots         \\
        \pdv{ Fm}{y_1} & \dots  & \pdv{ Fm}{y_m}
    \end{vmatrix}
\end{equation}
计算$y_j$对$x_i$的偏导时，只需将分母雅可比中的$y_j$替换成$x_i$，即可得出$\displaystyle\pdv{y_j}{x_i}$对应的分子雅可比。

\subsubsection{反函数定理}
.
\begin{theorem}
    （雅可比法则）
    \label{th:雅可比法则}
    设函数
    \[ z_i = z_i(y_i,\cdots,y_n),\quad y_i=y_i(x_1,\cdots,x_n),\quad (i=1,\cdots n) \]
    在拟讨论点附近连续可导，则
    \[
        \pdv{(z_1,z_n)}{(x_1,\cdots,x_m)}
        = \pdv{(z_1,z_n)}{(y_1,\cdots,y_n)} \cdot \pdv{(y_1,y_n)}{(x_1,\cdots,x_n)}
    \]
\end{theorem}

\begin{theorem}
    （反函数定理）
    \label{th:反函数定理}
    设函数
    \[ y_i=y_i(x_1,\cdots,x_n),\quad (i=1,\cdots,n) \]
    在拟讨论点附近可导且$\displaystyle\pdv{(y_1,\cdots,y_n)}{(x_1,\cdots,x_n)}\neq 0$，则在该点附近反函数
    \[ x_i = x_i(y_1,\cdots,y_n),\quad (i=1,\cdots,n) \]
    存在且连续可导，并有
    \begin{enumerate}[(1)]
        \item
              $
                  \displaystyle
                  \pdv{x_i}{y_j}
                  = \left.(-1)^{i+j} \pdv{(y_1,\cdots,y_{j-1},y_{j+1},\cdots,y_n)}{(x_1,\cdots,x_{i-1},x_{i+1},\cdots,x_n)}
                  \middle/
                  \pdv{(y_1,\cdots,y_n)}{(x_1,\cdots,x_n)}
                  \right.
              $
        \item
              $
                  \pdv{(x_1,\cdots,x_n)}{(y_1,\cdots,y_n)} = \left.1\middle/\pdv{(y_1,\cdots,y_n)}{(x_1,\cdots,x_n)}\right.
              $
    \end{enumerate}
\end{theorem}

\section{偏导数的应用}
\subsection{方向导数}
如果$l$是从$P_0$点出发的射线，则函数$f(P)$在$P_0$点沿射线$l$的方向导数由极限
\begin{equation}
    \pdv{f}{l} = \lim_{P\to P_0,P\in l}\frac{f(P)-f(P_0)}{\abs{PP_0}}
\end{equation}
确定。如果射线$l$的参数方程为
\[
    l:
    \begin{cases}
        x = x_0 + \rho\cos\alpha &          \\
        y = y_0 + \rho\cos\beta, & \rho >0. \\
        z = z_0 + \rho\cos\gamma &
    \end{cases}
\]
因此，方向导数的坐标形式为
\begin{equation}
    \pdv{f}{l} = \lim_{\rho\to 0^+}\frac{f(x_0 + \rho\cos\alpha,y_0 + \rho\cos\beta,z_0 + \rho\cos\gamma)-f(x_0,y_0,z_0)}{\rho}
\end{equation}
当$f(x,y,z)$可微时，由洛必达法则和复合函数求导法则，有
\begin{align*}
    \pdv{f}{l}(x_0,y_0,z_0)
     & = \pdv{f}{x}\cos\alpha + \pdv{f}{y}\cos\beta + \pdv{f}{z}\cos\gamma                                          \\
     & = \eval{\left(\pdv{f}{x},\pdv{f}{y},\pdv{f}{z}\right)}_{(x_0,y_0,z_0)}\vdot(\cos\alpha,\cos\beta,\cos\gamma) \\
     & = \grad f(x_0,y_0,z_0)\vdot \bm{e}_l
\end{align*}

其中$\bm{e}_l=(\cos\alpha,\cos\beta,\cos\gamma)$为射线$l$的方向，向量
\begin{equation}
    \grad f(x_0,y_0,z_0)=\eval{\left(\pdv{f}{x},\pdv{f}{y},\pdv{f}{z}\right)}_{(x_0,y_0,z_0)}
\end{equation}
称为函数$f(x,y,z)$在$(x_0,y_0,z_0)$点的梯度。简言之，\textbf{\textsf{函数的方向导数就是梯度在给定射线方向上的投影}}。
\begin{equation}
    \pdv{f}{l} = \grad f\vdot \bm{e}_l
\end{equation}

需要注意的是，函数可导，某一方向的方向导数不一定存在。某点的任意方向导数存在，但是可以不可微，也可以不可导。
这是因为方向导数是按某一方向的单侧导数；但偏导数要求左右导数相等（此时方向相反的方向导数应互为相反数）。


\subsection{梯度}
符号$\grad=\left(\pdv{x},\pdv{y},\pdv{z}\right)$称为Hamilton算子。
梯度的重要性在于
\begin{enumerate}[(1)]
    \item 梯度的模表示函数的最大方向导数，梯度的方向表示函数的最大增长方向；
    \item 梯度是等值面的法向量；
    \item 函数的方向导数是梯度的定向投影。
\end{enumerate}

根据方向导数与梯度的关系，梯度的模表示函数的最大方向导数，梯度的方向表示函数的最大增长方向。对于(2)来说，不妨等值曲面
\[ \Sigma : f(x,y,z) = f(x_0,y_0,z_0) \]
设
\[ C: \bm{r}(t) = (x(t),y(t),z(t)),\quad \bm{r}(0) = (x_0,y_0,z_0) \]
为曲面$\Sigma$上任意一条光滑曲线，则有
\[ f(x(t),y(t),z(t)) \equiv f(x_0,y_0,z_0) \]
根据复合函数求导法则对$t$求导，则有
\[
    \pdv{f}{x} x'(t) + \pdv{f}{y} y'(t) + \pdv{f}{z} z'(t)
    = \grad f\vdot\bm{r}'(t)
    = 0
\]
这表明梯度$\grad f$是曲面$\Sigma$在点$(x_0,y_0,z_0)$处的法向量，因此梯度是等值面的法向量。所以一个曲面在某点的切平面，法线方程可以利用梯度求出。

对于两个曲面的交线
\[
    L :
    \begin{cases}
        f(x,y,z) = 0 \\
        g(x,y,z) = 0
    \end{cases}
\]
$L$上某点的切线
\sidenote{
    法平面：过交线上某一定点，且以此点的交线方向向量为法向量的平面称为法平面。
}
可以由两个曲面在此点的切平面相交而得，其切线方向为
\[
    \bm{v} = \grad f \times \grad g
    =
    \begin{vmatrix}
        \bm{i} & \bm{j} & \bm{k} \\
        f'_x   & f'_y   & f'_z   \\
        g'_x   & g'_y   & g'_z
    \end{vmatrix}
    = \left(\pdv{f,artial(y,z)}, \pdv{f,artial(z,x)},\pdv{f,artial(x,y)}\right)
\]
简言之，\textbf{\textsf{交线方向梯度叉}}。

梯度的运算法则如下
\begin{enumerate}[(1)]
    \item （线性性）$\grad (\lambda u + \mu v) = \lambda \grad u + \mu \grad v$，其中$\lambda,\mu$为常数；
    \item （乘法则）$\grad(uv) = v\grad u + u\grad v$；
    \item （除法则）$\grad\left(\dfrac{u}{v}\right) = \dfrac{v\grad u - u\grad v}{v^2}$；
    \item （链法则）$\grad F(u) = F'(u)\grad u, \grad F(u,v) = F'_u(u,v)\grad u + F'_v(u,v)\grad v$
\end{enumerate}

\subsection{泰勒公式}
仿照一元函数的泰勒公式，二元函数的泰勒公式如下
\begin{theorem}
    设二元函数$f(x,y)$在$(x_0,y_0)$的邻域内有$n+1$阶连续导数，并且设$(x_0+h,y_0+k)$位于该邻域内，则存在$\theta\in(0,1)$使得，
    \[
        f(x_0+h,y_0+k) = \sum_{m=1}^n \frac{1}{m!}\left(h\pdv{x} + k\pdv{y}\right)^mf(x_0,y_0) + R_n
    \]
    其中
    \[
        R_n = \frac{1}{(n+1)!}\left(h\pdv{x} + k\pdv{y}\right)^{n+1}f(x_0+\theta h,y_0 +\theta k)
    \]

    多元函数的泰勒公式也可以表示为Peano形式，例如
    \begin{equation}
        \begin{split}
            f(x_0+\Delta x, y_0 + \Delta y) = f(x_0,y_0) + f'_x(x_0,y_0)\Delta x + f'_y(x_0,y_0)\Delta y \\
            + \frac{1}{2}\left(A\Delta x^2 + 2B\Delta x\Delta y + C\Delta y^2\right) + o(\rho^2),\quad (\rho\to 0)
        \end{split}
    \end{equation}
    其中$A=f''_{xx}(x_0,y_0),B=f''_{xy}(x_0,y_0),C=f''_{yy}(x_0,y_0),\rho=\sqrt{\Delta x^2 + \Delta y^2}$
\end{theorem}

\subsection{自由极值}
在多元函数的极值问题中，没有约束条件（平面区域或空间区域上）的极值称为\textcolor{red}{\textbf{\textsf{自由极值}}}，
带有约束条件（曲面或曲线上）的极值称为\textcolor{red}{\textbf{\textsf{条件极值}}}。

仿照一元函数极值的定义，多元函数的极值可以定义为
\begin{definition}
    设二元函数$f(x,y)$在$(x_0,y_0)$点的某邻域内有定义，如果$(x,y)$位于该邻域时恒有$f(x,y)\leq f(x_0,y_0)$，则称$f(x_0,y_0)$时函数$f(x,y)$的极大值，
    $(x_0,y_0)$时$f(x,y)$的极大值点。
\end{definition}

值得注意的是，函数极值的存在性与函数的可导没有直接关系。例如在$f(x,y)$在$(x_0,y_0)$处取得极值，但此点不一定可导。

\begin{theorem}
    （极值的必要条件）
    设二元函数$f(x,y)$在$(x_0,y_0)$点可导，且有极值，则
    \[ \eval{\pdv{f}{x}}_{(x_0, y_0)} = \eval{\pdv{f}{y}}_{(x_0, y_0)} = 0 \]
\end{theorem}


通过泰勒公式，可以得出一个极值的充分条件。
\begin{theorem}
    （极值的充分条件）
    设函数$f(x,y)$在$(x_0,y_0)$点附近有连续的二阶偏导，并且$(x_0,y_0)$时临界点，如果
    \[ A = f''_{xx}(x_0,y_0),\, B = f''_{xy}(x_0,y_0),\, C = f''_{yy}(x_0,y_0) \]
    则有
    \begin{enumerate}[(1)]
        \item 当$B^2 - AC < 0$，且$A>0$，则$f(x_0,y_0)$为极小值；
        \item 当$B^2 - AC < 0$，且$A<0$，则$f(x_0,y_0)$为极大值；
        \item 当$B^2 - AC > 0$，则$f(x_0,y_0)$不是极值；
        \item 当$B^2 - AC = 0$，则$f(x_0,y_0)$可能是极值，也可能不是极值。
    \end{enumerate}
\end{theorem}
\begin{proof}
    设$f(x,y)$在临界点$(x_0,y_0)$附近有连续的二阶偏导，根据泰勒公式，有
    \begin{align*}
        f(x,y)
        = & f(x_0,y_0) + f'_x(x_0,y_0)\Delta x + f'_y(x_0,y_0)\Delta y                \\
          & + \frac{1}{2}(A\Delta x^2 + 2B\Delta x\Delta y + C\Delta y^2) + o(\rho^2) \\
        = & + \frac{1}{2}(A\Delta x^2 + 2B\Delta x\Delta y + C\Delta y^2) + o(\rho^2)
    \end{align*}
    移项得
    \[
        f(x,y) - f(x_0,y_0) = \frac{1}{2}(A\Delta x^2 + 2B\Delta x\Delta y + C\Delta y^2) + o(\rho^2)
    \]
    其中$ A = f''_{xx}(x_0,y_0),\, B = f''_{xy}(x_0,y_0),\, C = f''_{yy}(x_0,y_0)$，
    那么根据二次函数有
    \[ \Delta = 4B^2 - 4AC = 4(B^2 - AC) \]
    当二次函数有零点时，解为一个过原点的直线，即$\Delta x = \lambda \Delta y$，以下讨论$f(x,y)-f(x_0,y_0)$的符号。
    \begin{enumerate}[(1)]
        \item 当$B^2 - AC < 0$，且$A>0$，则此邻域内恒有$f(x,y)-f(x_0,y_0)>0$，即$f(x_0,y_0)<f(x,y)$，此时$f(x_0,y_0)$为极小值；
        \item 同理有当$B^2 - AC < 0$，且$A<0$，$f(x_0,y_0)$为极大值;
        \item 当$B^2 - AC > 0$时，二次函数有两个不同的零点，在此邻域内$f(x,y)-f(x_0,y_0)$的符号有变化，故$f(x_0,y_0)$不是极值；
        \item 当$B^2 - AC = 0$时，二次函数只有一个零点，设为$\Delta x =\lambda\Delta y$。当此直线的两侧的函数值同号时，$f(x_0,y_0)$是极值，否则不是极值。
    \end{enumerate}
\end{proof}

\begin{example}
    设$f(x,y)$是连续函数，且$\lim_{(x,y)\to(0,0)}\dfrac{f(x,y)-f(0,0)}{x^3+y^3 - 3x^2 - 3y^2} = 1$，
    判断$(0,0)$是否为极值点。
\end{example}
\begin{solution}
    设
    \[ g(x,y) = x^3 + y^3 - 3x^2 -3y^2 \]
    则有
    \[ g'_x(0,0) = g'_y(0,0) = 0 \]
    \[ A = g''_{xx}(0,0) = -6, \quad B = g''_{xy}(0,0) = 0, \quad C = g''_{yy}(0,0) = -6 \]
    则有
    \[\Delta = B^2 - AC < 0, \quad A  < 0 \]
    则$(0,0)$为极大值点，$g(0,0) = 0$。故在$(0,0)$的去心邻域内，恒有$g(x,y)<0$
    即极限的分母为负，根据极限的保号性，存在$\delta > 0$，使当$0 < \sqrt{x^2 + y^2} < \delta$，
    \[
        \frac{f(x,y) - f(0,0)}{x^3 + y^3 - 3x^2 -3y^2} > 0 \implies f(x,y) < f(0,0)
    \]
    所以$(0,0)$为极大值点。
\end{solution}

\begin{example}
    设$f(x,y)$在点$O(0,0)$的某邻域$U$内连续，且$\lim_{(x,y)\to(0,0)}\frac{f(x,y) - xy}{x^2 + y^2} = a > \frac{1}{2}$，
    判断$(0,0)$是否为极值点。
\end{example}
\begin{solution}
    由题目极限可设
    \[ \frac{f(x,y) - xy}{x^2 + y^2} = a + \alpha \]
    即
    \[ f(x,y) = (a + \alpha)(x^2 + y^2) + xy \]
    其中$\lim_{(x,y)\to(0,0)} \alpha = 0$，则$\alpha$在$(x,y)\to(0,0)$时有界，不妨先将其作为常数。
    根据$f(x,y)$的连续性可知
    \[ f(0,0) = \lim_{(x,y)\to(0,0)} f(x,y) = \lim_{(x,y)\to(0,0)} [(a + \alpha)(x^2 + y^2) + xy] = 0 \]
    则设
    \[ g(x,y) = f(x,y) - f(0,0) = (a + \alpha)(x^2 + y^2) + xy \]
    \[ g'_x(0,0) = g'_y(0,0) = 0 \]
    \[ A = g''_{xx}(0,0) = 2(a+\alpha), \quad B=g''_{xy}(0,0) = 1,\quad C = g''_{yy}(0,0) = 2(a+\alpha) \]
    则有
    \[ \Delta = B^2 - AC = 1 - 4(a+\alpha)^2 \]
    令$\Delta < 0$，得
    \[ \alpha \in (-\infty,  - \frac{1}{2} - a) \cup (\frac{1}{2} - a, +\infty) \]
    由于$\lim_{(x,y)\to(0,0)} \alpha = 0$，则存在$\delta > 0$，使当$0<\sqrt{x^2 + y^2}<\delta$时，恒有
    \[ \abs{\alpha} < a - \frac{1}{2} \]
    即
    \[ \alpha \in (\frac{1}{2} - a, a - \frac{1}{2}) \]
    属于$\Delta < 0$的区间内，故在$O(0,0)$的去心邻域内恒有$g(x,y) > g(0,0)$，即$f(x,y) > f(0,0)$，
    所以$(0,0)$为极小值点。
\end{solution}

\begin{example}
    求二元函数$z=f(x,y)=x^2y(4-x-y)$在由直线$x+y=6$，$x$轴和$y$轴所围成的闭区域$D$上的极值，最大值和最小值。
\end{example}
\begin{solution}
    令
    \[
        \begin{cases}
            f'_x  = 2xy(4-x-y) - x^2y = = xy(8-3x-2y) =  0 \\
            f'_y  = x^2(4-x-y) - x^2y = x^2(4-x-2y) = 0
        \end{cases}
    \]
    则有
    \[
        \begin{cases}
            x = 0                        \\
            y = 0 \text{ 且~} 4-x-2y = 0 \\
            8-3x-2y = 0 \text{ 且~} 4-x-2y = 0
        \end{cases}
    \]
    解得$x=0, (x,y)=(4,0), (x,y)=(2,1)$，其中只有$(2,1)$为内点。
    \[ A = f''_{xx}(2,1) = -6 ,\quad B = f''_{xy}(2,1) = -4, C = f''_{yy}(2,1) = -8 \]
    则有
    \[ \Delta = B^2 -AC -32 < 0,\quad A < 0 \]
    所以闭区域$D$的极大值为$f(2,1)=4$。

    在线段$x=0(0\leq y \leq 6)$上有$z=f(0,y)=0$。在线段$y=0(0\leq x\leq 6)$上有$z=f(x,0)=0$

    在直线$x+y=6$上，令$y=6-x$代入$z=f(x,y)$中，得$g(x) = z =-2x^2(6-x)=2x^3-12x^2,(0\leq x\leq 6)$，
    令
    \[ g'(x) = 6x^2 -24x =0 \]
    得$x = {0, 4}$，所以$g(0) = 0, g(4) = -64, g(6) = 0$

    综上所得点得函数值，可知$z_{\max} = f(2,1) = 4, z_{\min} = f(4,2) = -64$，极大值为$f(2,1)=4$。


\end{solution}

\subsection{条件极值}
条件极值常常需要转化为自由极值，有时候可以通过消去一个变量变为自由极值，更多情况下可以通过增加一个变量变为自由极值（拉格朗日数乘法）。

考察条件极小值问题
\[
    \begin{cases}
        f(x,y,z) \to \min, \\
        \varphi(x,y,z) = 0.
    \end{cases}
\]
假设$S:\varphi(x,y,z)=0$是一个光滑曲面且$P(x_0,y_0,z_0)$是函数$f:S\to R$（即曲面上的点的对应函数值）的极小值点。
又设$\Gamma : \bm{r} = \bm{r}(t) = (x(t),y(t),z(t))$是曲面$S$上的任意一条光滑曲线，且满足$\bm{r}(0)=(x_0,y_0,z_0)$，则$t=0$是一元函数$g(t)=f(x(t),y(t),z(t))$的极小值点。
因此有$g'(t)=0$，即
\[
    \eval{\pdv{f}{x}x'(t) + \pdv{f}{y}y'(t) + \pdv{f}{z}z'(t)}_{t=0}
    =
    \grad f(x_0,y_0,z_0) \cdot \bm{r}'(0) = 0
\]
这表明$\grad f(x_0,y_0,z_0)$垂直于曲面$S$在$P$点的切平面，故$\grad f(x_0,y_0,z_0)$是曲面$S$在点$P$的法向量。

另一方面，曲面$S$在点$P$的法向量为$\grad\varphi(x_0,y_0,z_0)$，因此两个法向量线性相关，引入常数$\lambda$。故有
\[ \grad f(x_0,y_0,z_0) + \lambda\grad\varphi(x_0,y_0,z_0) = 0 \]
由此设拉格朗日函数
\begin{equation}
    \label{eq:拉格朗日函数}
    L(x,y,z,\lambda) = f(x,y,z) + \lambda\varphi(x,y,z)
\end{equation}
那么$(x_0,y_0,z_0)$是拉格朗日函数的临界点，即
\[ \grad L(x_0,y_0,z_0,\lambda) = \grad f(x_0,y_0,z_0) + \lambda\grad\varphi(x_0,y_0,z_0) = 0 \]
因此只需解临界方程，可得出条件极值的极值点。

梯度形式：
\begin{equation}
    \label{eq:拉格朗日临界方程}
    \grad L(x,y,z,\lambda) = 0
\end{equation}
方程组形式：
\begin{equation}
    \begin{dcases*}
        \pdv{L}{x} = 0,       \\
        \pdv{L}{y} = 0,       \\
        \pdv{L}{z} = 0,       \\
        \pdv{L}{\lambda} = 0. \\
    \end{dcases*}
\end{equation}

\begin{example}
    在第一象限的椭圆$\frac{x^2}{4} + y^2 = 1$上求一点，使过该点的法线与原点的距离最大。
\end{example}
\begin{solution}
    设$f(x,y) = \frac{x^2}{4} + y^2 - 1 = 0$
    \[ \bm{n} = \left(\pdv{f}{x}, \pdv{f}{y}\right) = \left(\frac{x}{2}, 2y\right) \]
    则法线方程为
    \[ \frac{X - x}{\frac{x}{2}} = \frac{Y - y}{2y} \]
    即
    \[ 2y(X-x)-\frac{x}{2}(Y-y) = 0 \]
    故法线到原点的距离为
    \[
        d
        = \abs{\frac{2y(0-x)-\frac{x}{2}(0-y)}{\sqrt{(2y)^2 + \left(-\frac{x}{2}\right)^2}}}
        = \frac{3}{2}\frac{\abs{xy}}{\sqrt{(2y^2)+\left(\frac{x}{2}\right)^2}}
        = \frac{3}{2} \left[\left(\frac{2}{x}\right)^2 + \left(\frac{1}{2y}\right)^2\right]^{-\frac{1}{2}}
    \]
    为简化运算，设$g(x,y) = (\dfrac{2}{x})^2 + (\dfrac{1}{2y})^2$，拉格朗日函数$L(x,y,\lambda) = g(x,y) + \lambda f(x,y)$
    则当$g(x,y)$取最小值时，$d$最大。
    令
    \[
        \begin{dcases}
            L'_x = -\frac{8}{x^3} + \frac{\lambda}{2} x = 0 \\
            L'_y = -\frac{1}{2y^3} + 2\lambda y = 0         \\
            L'_\lambda = f(x,y)=0
        \end{dcases}
    \]
    所以有$\lambda = \dfrac{16}{x^4} = \dfrac{1}{4y^4}$，解得$x=2\sqrt{2}y$，带入$f(x,y)=0$
    得$y = \frac{\sqrt{3}}{3},x=\frac{2\sqrt{6}}{3}$。
    根据实际问题距离$d$存在最大值，又驻点唯一，故所得即所求，所以$\left(\dfrac{2\sqrt{6}}{3}, \dfrac{\sqrt{3}}{3}\right)$为所求点。
\end{solution}

此题目较难的是构造拉格朗日选用的函数，复杂的函数会使求导变为复杂，所以应该适当地将目的函数变形。利用变形后的函数来构造拉格朗日函数，使求导变简单。